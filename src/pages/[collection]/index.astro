--- 
import Layout from "../../layouts/Layout.astro"

const { collection } = Astro.params;
import { contentfulClient } from "../../utils/contentful";

const response = await contentfulClient.getEntries({
  content_type: 'blogPost',
  'metadata.tags.sys.id[in]': collection,
  select: 'fields.title,fields.slug,fields.date'
})
const posts = response.items.map((item) => {
  return {
    data: item.fields,
    slug: item.fields.slug
  }
})

const postsByDate = posts.sort((a, b) => {
  return b.data.date - a.data.date;
});
//capitalize collection name
const collectionName = collection.charAt(0).toUpperCase() + collection.slice(1);
---

<Layout>
    <h1 class="font-black text-7xl">{collectionName}</h1>
    <br />
    <div class="flex flex-col gap-5">
        {
            postsByDate.map((post) => {
                return (
                    <div class="flex gap-5">
                        <p class="italic">{new Date(post.data.date).toLocaleDateString('en-GB')}</p>
                        <a class="underline" href={collection + "/" + post.slug}>{post.data.title}</a>
                    </div>
                )
            })
        }
    </div>
</Layout>